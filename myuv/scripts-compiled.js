year=display_title=movie_title=imdb_id=autocomplete_title=rt_id=have_searched=!1;
$(document).ready(function(){$(".cover, .loader").hide();$("#search").attr("placeholder","movie name -> press enter");$("#about").hide();$("#search").autocomplete({source:function(a,c){$.ajax({url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",data:{apikey:"f278acux2dr8vmmueege9bfv",page_limit:5,page:1,q:a.term},success:function(a){c($.map(a.movies,function(a){a.alternate_ids&&a.alternate_ids.imdb&&(imdb_id="tt"+a.alternate_ids.imdb);return{label:a.title+" ("+(""+a.year)+
")",value:a.title,imdb:imdb_id,rtid:a.id,year:""+a.year}}))},error:function(){$("#search").autocomplete("disable").delay(5E3).autocomplete("enable")}})},delay:10,minLength:3,position:{my:"top",at:"center bottom"},focus:function(a,c){$("#search").val(c.item.value)},select:function(a,c){imdb_id=c.item.imdb;autocomplete_title=c.item.value;rt_id=c.item.rtid;movie_title=c.item.value;year=c.item.year;display_title=movie_title+" <span class='dem'>("+year+")</span>";find_movie()}});check_and_search()});
function show_about(){$("#about").slideToggle(500)}function make_url_able(a){return a.replace(/_/g,"+").replace(/'\w{1}\b/g,"").replace(/[-\u00b7]/g,"_").replace(/\W+/g,"+").replace(/_/g,"-")}function percent_match(a,c){for(var j=a.toLowerCase().split(/\W+/),e=c.toLowerCase().split(/\W+/),h=0,d=0;d<e.length;d++)0<=j.indexOf(e[d])&&(h+=1);return h/e.length}
function check_and_search(){var a=get_url_val("id");if(a)imdb_id=a,loading_movie_effect(),query_now();else if(a=get_url_val("q"))title_url=a,loading_movie_effect(),query_now()}function get_url_val(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.hash);return null!==a?decodeURIComponent(a[1].replace(/\+/g," ")):!1}function set_url_val(a,c){window.location.hash="#s?"+a+"="+c}
function loading_movie_effect(){$("#search").autocomplete("disable").autocomplete("close");$(".cover").show().animate({opacity:0.5},200);$(".loader").show().animate({opacity:1},200);$("#search").attr("placeholder","another movie -> press enter")}function find_movie(){loading_movie_effect();title_search=$("#search").val();$("#search").blur();title_url=make_url_able(title_search);autocomplete_title!=title_url&&(rt_id=imdb_id=!1);query_now()}
function query_now(){source_classes=[];source_names=[];scores=[];out_of=[];count=0;page_limit="10";ajax_count=0;total=3;imdb_id?set_url_val("id",imdb_id):set_url_val("q",title_url);do_imdb()}imdb_fail=!1;
function do_imdb(){var a="http://www.imdbapi.com/?",a=imdb_id?a+("i="+imdb_id):a+("t="+title_url);$.ajax({url:a,dataType:"jsonp",timeout:1E4,success:function(a){if("True"==a.Response){if(!year||!movie_title)year=a.Year,movie_title=a.Title,display_title=movie_title+" <span class='dem'>("+year+")</span>";imdb_id=a.imdbID;"N/A"!=a.imdbRating?(source_classes[count]="imdb",source_names[count]="IMDB",scores[count]=a.imdbRating,out_of[count]="/ 10",imdb_fail=!1,count+=1):imdb_fail=!0}else imdb_fail=!0},
error:function(){imdb_fail=!0},complete:function(){do_rt()}})}
function do_rt(){var a;a=rt_id?"http://api.rottentomatoes.com/api/public/v1.0/movies/"+rt_id+".json?apikey=f278acux2dr8vmmueege9bfv":movie_title?"http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=f278acux2dr8vmmueege9bfv&page_limit="+page_limit+"&q="+make_url_able(movie_title):"http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=f278acux2dr8vmmueege9bfv&page_limit="+page_limit+"&q="+title_url;$.ajax({url:a,dataType:"jsonp",timeout:5E3,success:function(a){if(rt_id||0<a.total){if(!rt_id){var j=
Math.min(a.total,page_limit);match_query=movie_title?movie_title:title_search;var e=0,h=0;for(i=0;i<j;i++){var d=!1;a.movies[i].alternate_ids&&a.movies[i].alternate_ids.imdb&&(d="tt"+a.movies[i].alternate_ids.imdb);if(imdb_id&&imdb_id==d)break;if(a.movies[i].title==movie_title&&a.movies[i].year==year)break;d=percent_match(match_query,a.movies[i].title);d>e&&(e=d,h=i)}i>=j&&(i=h);a=a.movies[i]}if(!year||!movie_title)year=a.year.toString(),movie_title=a.title,display_title=movie_title+" <span class='dem'>("+
year+")</span>";!imdb_id&&(a.alternate_ids&&a.alternate_ids.imdb)&&(imdb_id="tt"+a.alternate_ids.imdb);0<=a.ratings.critics_score&&(source_classes[count]="rtc",source_names[count]="Rotten Tomatoes: Critics",scores[count]=a.ratings.critics_score,out_of[count]="%",count+=1);0<a.ratings.audience_score&&(source_classes[count]="rta",source_names[count]="Rotten Tomatoes: Audience",scores[count]=a.ratings.audience_score,out_of[count]="%",count+=1)}},error:function(){},complete:function(){do_tmdb()}})}
function do_tmdb(){var a;imdb_id?a="http://api.themoviedb.org/2.1/Movie.imdbLookup/en/json/bb0d9620f620e8097998203a8af18aec/"+imdb_id:(a="http://api.themoviedb.org/2.1/Movie.search/en/json/bb0d9620f620e8097998203a8af18aec/"+title_url,year&&(a=a+"+"+year));$.ajax({url:a,dataType:"jsonp",timeout:5E3,success:function(a){if(a.length>0&&a[0].rating){if(!year||!movie_title){year=a[0].released.split("-")[0];movie_title=a[0].name;display_title=movie_title+" <span class='dem'>("+year+")</span>"}source_classes[count]=
"tmdb";source_names[count]="The Movie DB";scores[count]=a[0].rating;out_of[count]="/ 10";count=count+1}},error:function(){},complete:function(){imdb_fail?do_imdb_backup():fill_output(display_title,source_classes,source_names,scores,out_of)}})}
function imdbapi(a){if(1!=a.code&&"n/a"!=a.rating){if(!year||!movie_title)year=a.year,movie_title=a.title,display_title=movie_title+" <span class='dem'>("+year+")</span>";imdb_id=a.imdbid;source_classes[count]="imdb";source_names[count]="IMDB";scores[count]=a.rating;out_of[count]="/ 10";count+=1}}
function do_imdb_backup(){var a;imdb_id?a="http://www.deanclatworthy.com/imdb/?id="+imdb_id:movie_title?(a="http://www.deanclatworthy.com/imdb/?q="+make_url_able(movie_title),year&&(a=a+"&year="+year)):a="http://www.deanclatworthy.com/imdb/?q="+title_url;$.ajax({url:a+"&type=jsonp",dataType:"jsonp",timeout:5E3,success:function(){},error:function(){},complete:function(){fill_output(display_title,source_classes,source_names,scores,out_of)}})}
function reset(){year=display_title=movie_title=imdb_id=autocomplete_title=rt_id=have_searched=!1}
function fill_output(a,c,j,e,h){reset();$("#search").autocomplete("enable");$(".cover, .loader").animate({opacity:0},200,function(){$(this).hide()});if(a){for(var d=[],f='<div class="entry_output"> <div class="scores_output">',b=0;b<c.length;b++)e[b]=Math.max(e[b],0),f+='      <div class="SOURCE_CLASS source"> \n        <div class="empty"></div> \n        <p> SOURCE_NAME </p> \n        <div class="fill"></div> \n        <div class="score"> \n          <span class="num">SCORE</span> \n          <span class="dem">OUT_OF</span> \n        </div> \n      </div> '.replace("SOURCE_CLASS",c[b]).replace("SOURCE_NAME",
j[b]).replace("SCORE",e[b]).replace("OUT_OF",h[b]),d[b]="%"==h[b]?parseFloat(e[b])/100:parseFloat(e[b])/parseFloat(h[b].split(" ")[1]);a=$(f+(' </div>\n    <div class="movie_footer"> <p>'+a+"</p> </div> \n    </div>"));j=100/d.length;j=j.toString()+"%";for(b=0;b<d.length;b++){a.find("."+c[b]).css("width",j);var e=200*d[b]-2,h=198-e,f=50,g,k;0.5>d[b]?(g=255,k=510*d[b]):(k=255,g=255*(1-2*(d[b]-0.5)));border_red=parseInt(g/2).toString(16);border_green=parseInt(k/2).toString(16);border_blue=parseInt(f/
2).toString(16);g=parseInt(g);g=g.toString(16);k=parseInt(k).toString(16);f=parseInt(f).toString(16);2>g.length&&(g="0"+g);2>k.length&&(k="0"+k);2>f.length&&(f="0"+f);f="#"+g+k+f;g="#"+border_red+border_green+border_blue;a.find("."+c[b]+" .empty").css("height",h);a.find("."+c[b]+" .fill").css({height:e,backgroundColor:f,borderColor:g})}a.hide();$(".outputs").prepend(a);a.slideDown(500);$("#search").val("").blur()}else alert("Either your internet isn't working or the movie you're searching for is too hipster for the mainstream databases.")}
;
